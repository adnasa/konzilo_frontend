div(kntnt-article-picker)
.container-fluid.main-content
  .row-fluid.content
    .span3
      .box.pad
        div(kntnt-clipboard-article-parts, selected="article", link-pattern="#/order/:article/:part")
    .span9(ng-show="!part")
      .box.pad
        h1 {{ "ORDER.TITLE" | translate }}
        p {{ "ORDER.DESCRIPTION" | translate }}
    .span5(ng-show="part")
      .box.pad
        h2 {{ "ORDER.PARTDESC" | translate }}
        cmf-autosave-status(status="autosave")
        form.form.part-form.form-horizontal(ng-submit="savePart()", name="partForm")
          .control-group
            label.control-label(for="title") {{ "GLOBAL.WORKINGTITLE" | translate }}
            .controls
              input(type="text", name="title", ng-model="part.title", required)
          .control-group
            label.control-label(for="submitter") {{ "GLOBAL.SUBMITTER" | translate }}
            .controls
              entity-reference(ng-model="part.submitter", entity-type="Provider")
          .control-group
            label.control-label(for="provider") {{ "GLOBAL.PROVIDER" | translate }}
            .controls
              entity-reference(ng-model="part.provider", entity-type="Provider")
          .control-group
            label.control-label(for="deadline") {{ "GLOBAL.DEADLINE" | translate }}
            .controls
              input(type="text", ng-model="part.deadline", placeholder="{{'GLOBAL.DATE' | translate}}",
                datepicker-popup="yyyy-MM-dd", ng-change="changeDate()")
              input(type="text", ng-model="deadlinetime", ng-change="changeTime(deadlinetime, part.deadline)", placeholder="{{'GLOBAL.TIME' | translate}}")
          .control-group
            label.control-label(for="type") {{'GLOBAL.DELIVERY' | translate}}
            .controls
              select(name="type", ng-model="part.type", ng-options="key as value for (key, value) in types", required, ng-disabled="contentSaved(part)")
          .control-group
            label.control-label(for="language") {{ 'GLOBAL.LANGUAGE' | translate }}
            .controls
              select(name="language", ng-model="part.language")
                option(value="{{code}}", ng-repeat="(code, lang) in languages",
                  ng-selected="part.language == code") {{lang.name}}
          .control-group
            label.control-label(for="terms") {{ 'GLOBAL.TERMS' | translate }}
            .controls
              file-upload-list(ng-model="part.terms", bundle="document", preview="false")
          .control-group
            label.control-label(for="assignment") {{ 'GLOBAL.ASSIGNMENT' | translate }}
            .controls
              markdown-editor(ng-model="part.assignment", placeholder="Beskriv uppdraget h√§r.")
          .control-group
            label.control-label(for="teaser") {{ 'GLOBAL.DISPLAY' | translate }}
            .controls
              label.checkbox
                input(type="checkbox", ng-model="part.teaser")
                span {{'ORDER.SHOWLISTINGS' | translate}}

    .span4(ng-show="part")
      .tabbed-box
        tabset
          tab(heading="{{ 'ORDER.ARTICLE_TITLE' | translate}}")
            .inner.pad.form.form-horizontal.article-description
              .control-group
                label.control-label(for="date") {{'GLOBAL.PUBLISHING' | translate}}
                .controls
                  span {{article.publishdate |  date: 'yyyy-MM-dd'}} {{'ORDER.PUBLISHINFO' | translate}}
              .control-group(ng-show="article.unpublishdate")
                label.control-label(for="date") {{ 'GLOBAL.UNPUBLISHING' | translate }}
                .controls
                  span {{article.unpublishdate | date: 'yyyy-MM-dd' }}
              .control-group(ng-show="channel")
                label.control-label {{ 'GLOBAL.CHANNEL' | translate }}
                .controls
                  span.help-block(markdown="channel.description")
              .control-group(ng-show="target")
                label.control-label(for="target") {{ 'GLOBAL.TARGET' | translate }}
                .controls
                  span.help-block(markdown="target.description")
                  a(ng-click="showAnalysis(target)") {{ 'GLOBAL.SHOW_ANALYSIS' | translate }}
              .control-group(ng-show="article.step")
                label.control-label(for="steps") {{ 'GLOBAL.STEP' | translate }}
                .controls
                  span.help-block {{ target.steps[article.step].description }}
              .control-group(ng-show="article.step")
                label.control-label(for="target") {{ 'GLOBAL.SUBJECT' | translate }}
                .controls
                  span.help-block(ng-show="article.topic")
                    span {{ 'GLOBAL.TARGET_TOPIC_SPEC' | translate: translations  }}
              .control-group
                label.control-label {{ 'GLOBAL.KEYWORDS' | translate  }}
                .controls
                  span.help-block {{'GLOBAL.KEYWORD_SPEC' | translate: translations }}
                  ul.keywords
                    li.label.label-info(ng-repeat="item in article.keywords")
                      span {{item}}
              .control-group(ng-show="article.description")
                label.control-label(for="description") {{ 'GLOBAL.ARTICLE_IDEA' | translate }}
                .controls
                  .text(markdown="article.description")
          tab(heading="{{ 'GLOBAL.DISCUSSION' | translate }}")
            .inner.pad
              konzilo-comments(ng-model="part.comments")
          tab(heading="{{'GLOBAL.VERSIONS' | translate}}")
            .inner.pad
              konzilo-article-part-versions(part="part", link-pattern="#/order/:article_id/:id")
              konzilo-article-part-new-version(part="part")
